
# 데이터베이스 (1)

### **요즘 세상에서 배움이란?**

배움에는 시간이 걸린다! 가장 중요한 것은 버티는 힘! 어떤 측면에서는 즐길 수 있어야함.

내가 모르는 것이 무엇인지 생각 해봐야한다. 잘하는 사람 보고 기죽지 않아야 한다.

### 새로운 것을 처음 배울 때의 좋은 자세

- 아는 것과 모르는 것을 분명히 이해하는지
    - 멍청한 질문이라는 것은 없다는 것을 명심하기. 대충 알거나 모르면서 안 물어보는 것이 더 큰 문제.
- 마음 편하게 먹기
    - 내가 힘들면 다른 사람들도 힘들다.
    - 나보다 잘 하는 사람은 그만큼 시간을 쏟았기 때문이다.
- 성공의 비밀은 **발전이 더딘 기간을 인내하고 즐기는 것**이다.

### 데이터베이스가 왜 필요한가?

- 영구적 기록 가능하게 해준다. 그 기록 장치로 쓰는 것.
- 모든 서비스는 데이터를 만들어내고 이는 기록되어야 한다.
- 데이터를 어디에 저장할 것인가?
    - 가장 많이 쓰이는 것 : **RDBMS → MySQL, PostgreSQL**
- 빠른 처리 속도가 중요함. **(Production RDBMS)**
    - vs **Data warehouse RDBMS** → **속도보다 굉장히 큰 데이터를 처리할 수 있느냐(Scalability)**에 좀 더 포커스 맞춰져 있음. (**사용자들이 회사 내부 직원들**)
    - **용도 : 수집된 데이터를 가지고 더 좋은 의사결정을 지원해준다.** 회사 서비스 최적화 시킬 수 있음. → 데이터 엔지니어, 데이터 분석가, 데이터 과학자
    - **Data warehouse 종류 → 이것도 관계형 DB**
        - Google cloud의 Big Query
        - Snowflake
        - Amazon cloud의 Red shift
- **관계형 DB 직접 조작 → 언어 : SQL (Sequel)**

### 데이터 순환 구조 : 프로덕션용 데이터 베이스와 데이터 웨어하우스

1. Web service나 mobile app에서 생성되는 다양한 데이터들을 Production RDBMS에 저장함. → 처리속도 중요함
2. 서비스에서 생성되는 데이터 & 외부에서 만들어 지는 Data들을 추출해서 Data Warehouse에 저장 → 지표 설정 및 시각화
3. 데이터 웨어하우스 기반으로 사용자의 경험을 개인화 할 수 있다. 

→ 모두 SQL 사용한다.

**데이터 엔지니어** : 데이터 웨어하우스 관리 & 데이터 웨어하우스에 저장될 데이터 추출해오는 코드 작성하는 사람

**데이터 분석가** : 데이터 웨어하우스 데이터 기반으로 회사/ 팀의 중요 지표 등을 정리하고 시각화

→ 코딩하는 사람은 x 도메인에 대해서 잘 알고있어야함.

**데이터 과학자** : 수집된 데이터를 바탕으로 인공지능/머신러닝 모델 만듦으로서 사용자 경험 개선

### 다양한 데이터베이스의 종류

1. **관계형 DB: 구조화된 데이터 → 기본**
    - Production용 관계형 DB: MySQL, PostgreSQL 같이 데이터 처리 속도가 더 중요함.
    - Data warehouse용 관계형 DB: 처리 속도보다는 처리 할 수 있는 데이터 크기가 중요함.
2. **비관계형 DB: 비구조화 데이터도 다룬다. → Table같이 깔끔하게 구조화 되지 않았다.**
    - 흔히 NoSQL DB라고 부르기도 한다.
    - 보통은 **프로덕션용 관계형 DB를 보완**하기위한 용도로 많이 사용된다.
    - 크게 4종류가 존재
        - key/value : redis, memcache
        - document store : MongoDB
        - Wide Column Storage: Cassandra, HBase, DynamoDB
        - Search Engine : ElasticSearch

## 백엔드 시스템 구성도 예제 보기

- Front-end와 Back-end → 초기에는 이렇게 크게 두 직군이 존재
- 다른 직군의 등장
    - Full Stack: 개발 속도 내기 위해서 작은 회사에서 선호.
    - DevOps: 주로 백엔드에 집중 두고 서비스 운영 책임지는 팀 → 회사 규모가 있을 때 생김.
- 데이터 직군:
    - 데이터 엔지니어
    - 데이터 분석가
    - 데이터 과학자
- 시스템 구성의 변화: 2 tier → **client가 바로 DB 조작 (logic이 client단에 존재)**
    
    - 보통 데스크탑 응용프로그램에서 사용되는 아키텍쳐
    - **클라이언트와 서버**로 구성
    - 클라이언트: 사용자가 사용하는 UI (front-end)
    - 서버단이 데이터베이스가 된다. (back-end)

- **시스템 구성의 변화: 3 tier → 요즘 많이 사용되는 아키텍쳐**
    
    ![Untitled](https://s3-us-west-2.amazonaws.com/secure.notion-static.com/2d97bdb8-df2d-40fa-9db2-ddbc93c12eaa/Untitled.png)
    
    - 웹 서비스에서 많이 사용되는 아키텍쳐
    - **Presentation Tier** : frontend
    - **Application Tier** : Backend
    - **Data Tier** : Backend

### Spring Boot에서의 3-Tier 아키텍처

- SpringBoot : 자바 기반의 백엔드 프레임워크

### 관계형 데이터베이스의 중요성

- 어떤 구조이건 DB는 꼭 필요한 컴포넌트
- 이 DB를 잘 다룬 것이 좋은 개발자가 되기 위해 필요
    - 기본 : SQL을 잘 아는 것
- 백엔드 개발자로써 중요한 부분
    - **데이터 모델(Table)**을 잘 만들고 그것을 front 개발자와 공유 / 협업
    - 속도 개선을 위한 쿼리 성능 모니터링, 필요 시 **성능 개선** 수행

## 관계형 데이터베이스 소개

- 구조화된 데이터를 저장하고 질의할 수 있도록 해주는 스토리지
    - 엑셀 스프레드시트 형태의 테이블로 데이터 정의하고 저장
    - 테이블에는 **Column(열)과 Record(행)**이 존재
- 데이터 모델 → 백엔드 or DBA가 하게 되고, front가 데이터를 넘겨준다.
- 테이블을 어떻게 하느냐. Star Schema : 유닛 단위로 나눠놓고 일련 번호만 사용하는 방법
    - ↔ de-normalized Schema
- 관계형 데이터베이스를 조작하는 프로그래밍 언어가 SQL
    - DDL(Data Definition Language): 테이블의 포맷을 정의해주는 언어
    - DML(Data Manipulation Language): 테이블 데이터 조작/질의를 위한 언어

### 대표적인 관계형 데이터베이스

- 프로덕션 데이터 페이스
    - **OLAP**(OnLine Transaction Processing)
    - **빠른 속도**에 집중. 서비스에 필요한 정보 저장
- 데이터 웨어하우스
    - **OLAP**(OnLine Analytical Processing)
    - **처리 데이터 크기**에 집중. 데이터 분석 혹은 모델 빌딩등을 위한 데이터 저장
    - 보통 프로덕션 데이터베이스를 복사해서 데이터 웨어하우스에 저장 → 프로덕션 데이터베이스 영향 주지 않고 분석할 수 있음

### 관계형 데이터베이스의 구조

관계형 DB는 2 단계로 구성된다.

- 가장 밑단에는 테이블 존재
- 테이블들은 DB(혹은 Schema)라는 폴더 밑으로 구성

테이블의 구조 (테이블 스키마라고 부르기도함) → DDL을 통해서.

- 테이블은 레코드로 구성 (행)
- 레코드는 하나 이상의 컬럼(필드)로 구성 (열)
- 컬럼은 이름과 타임과 속성(pk)으로 구성된다.
- 
### SQL의 단점

- 구조화된 데이터를 다루는데 최적화가 되어있음
    - 정규표현식을 통해 비구조화된 데이터를 어느 정도 다루는 것은 가능하나 제약이 심함
    - 많은 관계형 데이터베이스들이 **플랫한 구조만 지원**함 (no nested like json)
        - 구글 Big Query는 nested structure 지원한다
    - 비구조화된 데이터를 다루는데 Spark, Hadoop과 같은 분산 컴퓨팅 환경이 필요해짐
        - 즉 SQL만으로는 비구조화 데이터를 처리하지 못한다
- 관계형 DB마다 SQL문법이 조금씩 다르다

### Star Schema

- Production RDBMS에서는 보통 스타 스키마를 사용해 데이터를 저장
- 데이터를 논리적 단위로 나눠**(fact table)** 저장하고 필요 시 **조인**한다 → **속도의 저하 가져올 수 있음**
- **스토리지의 낭비가 덜하고 업데이트가 쉽다**
    
    - 매장, 매출, 기간, 제품, 직원 테이블을 나눠 관리한다.

### Denormalized Schema

- NoSQL이나 데이터 웨어하우스에서 사용하는 방식
    - 데이터 웨어하우스는 Star Schema 사용해도 문제 없다
    - 하지만 데이터 웨어하우스는 사이즈 제약이 없기 때문에 (다수의 컴퓨터로 구성 - cluster 형태의 구조) → **storage 낭비해도 상관없기에 denormalized Schema 사용해도 된다**
- 단위 테이블로 나눠 저장하지 않음으로 별도의 조인이 필요 없는 형태를 말한다
- 스토리지를 더 사용하지만 조인이 필요 없기에 빠른 계산이 가능하다

### SQL 기본

- 먼저 다수의 SQL문 실행하면 세미콜론으로 분리 필요
- 주석 : — / 여러 줄: /* — */
- SQL 키워드는 대문자를 사용한다던지 하는 나름대로의 포맷팅이 필요
    - **팀 프로젝트라면 팀에서 사용하는 공통 포맷이 필요**
    - 테이블 이름, 필드 이름도 규칙 정하는 것이 좋다 (공통규칙)
- 테이블/필드 이름의 명명규칙을 정하는 것이 중요
    - 단수형 vs 복수형
        - User vs Users
    - snake_case vs CamelCasing
        - user_session_channel vs UserSessionChannel

### SQL DDL / DML

- CREATE TABLE
- Primar key 속성 지정할 수 있음
- 성능 향상을 위해서 인덱스를 지정할 수 있음
- DROP TABLE / DROP TABLE IF EXISTS
- DELETE FROM : 조건에 맞는 레코드들을 지움. 테이블 자체는 존재
- ALTER TABLE : 기존 테이블 변경
- DELETE FROM vs TRUNCATE : TRUNCATE는 조건 X 무조건 테이블의 레코드들 날리는 것